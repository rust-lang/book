# الأنواع العامة (Generics)، السمات (Traits)، وأعمار المتغيرات (Lifetimes)

تمتلك كل لغة برمجة أدوات للتعامل بفعالية مع تكرار المفاهيم. في Rust، إحدى هذه الأدوات هي _الأنواع العامة (generics)_: بدائل مجردة للأنواع الملموسة أو خصائص أخرى. يمكننا التعبير عن سلوك الأنواع العامة أو كيفية ارتباطها بأنواع عامة أخرى دون معرفة ما سيكون في مكانها عند ترجمة وتشغيل الكود.

يمكن للدوال أن تأخذ معاملات من نوع عام، بدلاً من نوع ملموس مثل `i32` أو `String`، بنفس الطريقة التي تأخذ بها معاملات بقيم غير معروفة لتشغيل نفس الكود على قيم ملموسة متعددة. في الواقع، قد استخدمنا بالفعل الأنواع العامة في الفصل 6 مع `Option<T>`، وفي الفصل 8 مع `Vec<T>` و `HashMap<K, V>`، وفي الفصل 9 مع `Result<T, E>`. في هذا الفصل، ستستكشف كيفية تعريف أنواعك ودوالك وتوابعك الخاصة باستخدام الأنواع العامة!

أولاً، سنراجع كيفية استخراج دالة لتقليل تكرار الكود. ثم سنستخدم نفس التقنية لإنشاء دالة عامة من دالتين تختلفان فقط في أنواع معاملاتهما. سنشرح أيضاً كيفية استخدام الأنواع العامة في تعريفات الهياكل (structs) والتعدادات (enums).

بعد ذلك، ستتعلم كيفية استخدام السمات (traits) لتعريف السلوك بطريقة عامة. يمكنك دمج السمات مع الأنواع العامة لتقييد نوع عام لقبول فقط تلك الأنواع التي لها سلوك معين، بدلاً من أي نوع فقط.

أخيراً، سنناقش _أعمار المتغيرات (lifetimes)_: نوع من الأنواع العامة التي تعطي المترجم معلومات حول كيفية ارتباط المراجع (references) ببعضها البعض. تسمح لنا أعمار المتغيرات بإعطاء المترجم معلومات كافية حول القيم المستعارة بحيث يمكنه التأكد من أن المراجع ستكون صالحة في حالات أكثر مما يمكن بدون مساعدتنا.

## إزالة التكرار من خلال استخراج دالة

تسمح لنا الأنواع العامة باستبدال أنواع محددة بعنصر نائب يمثل أنواعاً متعددة لإزالة تكرار الكود. قبل الغوص في صياغة الأنواع العامة، دعنا ننظر أولاً إلى كيفية إزالة التكرار بطريقة لا تتضمن أنواعاً عامة من خلال استخراج دالة تستبدل قيماً محددة بعنصر نائب يمثل قيماً متعددة. ثم سنطبق نفس التقنية لاستخراج دالة عامة! من خلال النظر إلى كيفية التعرف على الكود المكرر الذي يمكنك استخراجه في دالة، ستبدأ في التعرف على الكود المكرر الذي يمكن أن يستخدم الأنواع العامة.

سنبدأ بالبرنامج القصير في القائمة 10-1 الذي يبحث عن أكبر رقم في قائمة.

<Listing number="10-1" file-name="src/main.rs" caption="إيجاد أكبر رقم في قائمة من الأرقام">

```rust
{{#rustdoc_include ../listings/ch10-generic-types-traits-and-lifetimes/listing-10-01/src/main.rs:here}}
```

</Listing>

نخزن قائمة من الأعداد الصحيحة في المتغير `number_list` ونضع مرجعاً للرقم الأول في القائمة في متغير باسم `largest`. ثم نكرر على جميع الأرقام في القائمة، وإذا كان الرقم الحالي أكبر من الرقم المخزن في `largest`، فإننا نستبدل المرجع في ذلك المتغير. ومع ذلك، إذا كان الرقم الحالي أصغر من أو يساوي أكبر رقم تم رؤيته حتى الآن، فلن يتغير المتغير، وينتقل الكود إلى الرقم التالي في القائمة. بعد النظر في جميع الأرقام في القائمة، يجب أن يشير `largest` إلى أكبر رقم، والذي في هذه الحالة هو 100.

لقد تم تكليفنا الآن بإيجاد أكبر رقم في قائمتين مختلفتين من الأرقام. للقيام بذلك، يمكننا اختيار تكرار الكود في القائمة 10-1 واستخدام نفس المنطق في مكانين مختلفين في البرنامج، كما هو موضح في القائمة 10-2.

<Listing number="10-2" file-name="src/main.rs" caption="كود لإيجاد أكبر رقم في *قائمتين* من الأرقام">

```rust
{{#rustdoc_include ../listings/ch10-generic-types-traits-and-lifetimes/listing-10-02/src/main.rs}}
```

</Listing>

على الرغم من أن هذا الكود يعمل، إلا أن تكرار الكود ممل وعرضة للأخطاء. كما يتعين علينا أن نتذكر تحديث الكود في أماكن متعددة عندما نريد تغييره.

للتخلص من هذا التكرار، سننشئ تجريداً من خلال تعريف دالة تعمل على أي قائمة من الأعداد الصحيحة يتم تمريرها كمعامل. يجعل هذا الحل كودنا أكثر وضوحاً ويتيح لنا التعبير عن مفهوم إيجاد أكبر رقم في قائمة بشكل مجرد.

في القائمة 10-3، نستخرج الكود الذي يبحث عن أكبر رقم إلى دالة باسم `largest`. ثم نستدعي الدالة لإيجاد أكبر رقم في القائمتين من القائمة 10-2. يمكننا أيضاً استخدام الدالة على أي قائمة أخرى من قيم `i32` قد تكون لدينا في المستقبل.

<Listing number="10-3" file-name="src/main.rs" caption="كود مجرد لإيجاد أكبر رقم في قائمتين">

```rust
{{#rustdoc_include ../listings/ch10-generic-types-traits-and-lifetimes/listing-10-03/src/main.rs:here}}
```

</Listing>

تحتوي الدالة `largest` على معامل يسمى `list`، والذي يمثل أي شريحة ملموسة من قيم `i32` قد نمررها إلى الدالة. ونتيجة لذلك، عندما نستدعي الدالة، يعمل الكود على القيم المحددة التي نمررها.

باختصار، إليك الخطوات التي اتخذناها لتغيير الكود من القائمة 10-2 إلى القائمة 10-3:

1. تحديد الكود المكرر.
1. استخراج الكود المكرر إلى جسم الدالة، وتحديد المدخلات والقيم المرجعة لذلك الكود في توقيع الدالة.
1. تحديث الحالتين من الكود المكرر لاستدعاء الدالة بدلاً من ذلك.

بعد ذلك، سنستخدم هذه الخطوات نفسها مع الأنواع العامة لتقليل تكرار الكود. بنفس الطريقة التي يمكن بها لجسم الدالة العمل على `list` مجرد بدلاً من قيم محددة، تسمح الأنواع العامة للكود بالعمل على أنواع مجردة.

على سبيل المثال، لنفترض أن لدينا دالتين: واحدة تبحث عن أكبر عنصر في شريحة من قيم `i32` وأخرى تبحث عن أكبر عنصر في شريحة من قيم `char`. كيف يمكننا إزالة هذا التكرار؟ دعنا نكتشف ذلك!
