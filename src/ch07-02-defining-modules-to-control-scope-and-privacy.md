<!-- Old headings. Do not remove or links may break. -->

<a id="defining-modules-to-control-scope-and-privacy"></a>

## التحكم في النطاق والخصوصية باستخدام الوحدات

في هذا القسم، سنتحدث عن الوحدات وأجزاء أخرى من نظام الوحدات، وهي _المسارات_ التي تسمح لك بتسمية العناصر؛ والكلمة المفتاحية `use` التي تجلب المسار إلى النطاق؛ والكلمة المفتاحية `pub` لجعل العناصر عامة. سنناقش أيضاً الكلمة المفتاحية `as`، والحزم الخارجية، ومشغل glob.

### ورقة غش الوحدات

قبل أن نصل إلى تفاصيل الوحدات والمسارات، نقدم هنا مرجعاً سريعاً حول كيفية عمل الوحدات والمسارات والكلمة المفتاحية `use` والكلمة المفتاحية `pub` في المترجم، وكيف ينظم معظم المطورين شيفرتهم. سنستعرض أمثلة على كل من هذه القواعد خلال هذا الفصل، لكن هذا مكان رائع للرجوع إليه كتذكير بكيفية عمل الوحدات.

- **ابدأ من جذر الصندوق**: عند ترجمة صندوق، يبحث المترجم أولاً في ملف جذر الصندوق (عادةً _src/lib.rs_ لصندوق مكتبة و _src/main.rs_ لصندوق ثنائي) عن الشيفرة المراد ترجمتها.
- **تعريف الوحدات**: في ملف جذر الصندوق، يمكنك تعريف وحدات جديدة؛ لنفترض أنك تعرف وحدة "حديقة" بـ `mod garden;`. سيبحث المترجم عن شيفرة الوحدة في هذه الأماكن:
  - مضمنة، داخل أقواس معقوفة تستبدل الفاصلة المنقوطة التي تتبع `mod garden`
  - في الملف _src/garden.rs_
  - في الملف _src/garden/mod.rs_
- **تعريف الوحدات الفرعية**: في أي ملف آخر غير جذر الصندوق، يمكنك تعريف وحدات فرعية. على سبيل المثال، قد تعرف `mod vegetables;` في _src/garden.rs_. سيبحث المترجم عن شيفرة الوحدة الفرعية ضمن الدليل المسمى بوحدة الأصل في هذه الأماكن:
  - مضمنة، مباشرة بعد `mod vegetables`، داخل أقواس معقوفة بدلاً من الفاصلة المنقوطة
  - في الملف _src/garden/vegetables.rs_
  - في الملف _src/garden/vegetables/mod.rs_
- **مسارات الشيفرة في الوحدات**: بمجرد أن تصبح الوحدة جزءاً من صندوقك، يمكنك الإشارة إلى الشيفرة في تلك الوحدة من أي مكان آخر في نفس الصندوق، طالما أن قواعد الخصوصية تسمح بذلك، باستخدام المسار إلى الشيفرة. على سبيل المثال، النوع `Asparagus` في وحدة خضروات الحديقة سيكون موجوداً في `crate::garden::vegetables::Asparagus`.
- **خاص مقابل عام**: الشيفرة داخل الوحدة خاصة من وحدات أصلها بشكل افتراضي. لجعل الوحدة عامة، عرفها بـ `pub mod` بدلاً من `mod`. لجعل العناصر داخل وحدة عامة عامة أيضاً، استخدم `pub` قبل تعريفاتها.
- **الكلمة المفتاحية `use`**: ضمن نطاق، تنشئ الكلمة المفتاحية `use` اختصارات للعناصر لتقليل تكرار المسارات الطويلة. في أي نطاق يمكن أن يشير إلى `crate::garden::vegetables::Asparagus`، يمكنك إنشاء اختصار بـ `use crate::garden::vegetables::Asparagus;`، ومن ثم تحتاج فقط لكتابة `Asparagus` لاستخدام هذا النوع في النطاق.

هنا، ننشئ صندوقاً ثنائياً باسم `backyard` يوضح هذه القواعد. دليل الصندوق، المسمى أيضاً _backyard_، يحتوي على هذه الملفات والأدلة:

```text
backyard
├── Cargo.lock
├── Cargo.toml
└── src
    ├── garden
    │   └── vegetables.rs
    ├── garden.rs
    └── main.rs
```

ملف جذر الصندوق في هذه الحالة هو _src/main.rs_، ويحتوي على:

<Listing file-name="src/main.rs">

```rust,noplayground,ignore
{{#rustdoc_include ../listings/ch07-managing-growing-projects/quick-reference-example/src/main.rs}}
```

</Listing>

السطر `pub mod garden;` يخبر المترجم بتضمين الشيفرة التي يجدها في _src/garden.rs_، والتي هي:

<Listing file-name="src/garden.rs">

```rust,noplayground,ignore
{{#rustdoc_include ../listings/ch07-managing-growing-projects/quick-reference-example/src/garden.rs}}
```

</Listing>

هنا، `pub mod vegetables;` يعني أن الشيفرة في _src/garden/vegetables.rs_ مضمنة أيضاً. تلك الشيفرة هي:

```rust,noplayground,ignore
{{#rustdoc_include ../listings/ch07-managing-growing-projects/quick-reference-example/src/garden/vegetables.rs}}
```

الآن لندخل في تفاصيل هذه القواعد ونوضحها عملياً!

### تجميع الشيفرة ذات الصلة في الوحدات

تتيح لنا _الوحدات_ تنظيم الشيفرة داخل الصندوق من أجل القراءة وسهولة إعادة الاستخدام. تسمح لنا الوحدات أيضاً بالتحكم في _خصوصية_ العناصر لأن الشيفرة داخل الوحدة خاصة بشكل افتراضي. العناصر الخاصة هي تفاصيل تنفيذ داخلية غير متاحة للاستخدام الخارجي. يمكننا اختيار جعل الوحدات والعناصر داخلها عامة، مما يعرضها للسماح للشيفرة الخارجية باستخدامها والاعتماد عليها.

كمثال، لنكتب صندوق مكتبة يوفر وظيفة مطعم. سنعرف توقيعات الدوال لكن سنترك أجسامها فارغة للتركيز على تنظيم الشيفرة بدلاً من تنفيذ المطعم.

في صناعة المطاعم، يُشار إلى بعض أجزاء المطعم بـ front of house والبعض الآخر بـ back of house. _Front of house_ هو حيث يتواجد العملاء؛ وهذا يشمل حيث يجلس المضيفون العملاء، ويأخذ النوادل الطلبات والدفع، ويصنع السقاة المشروبات. _Back of house_ هو حيث يعمل الطهاة والطباخون في المطبخ، وينظف غاسلو الصحون، ويقوم المديرون بالعمل الإداري.

لهيكلة صندوقنا بهذه الطريقة، يمكننا تنظيم دواله في وحدات متداخلة. أنشئ مكتبة جديدة باسم `restaurant` بتشغيل `cargo new restaurant --lib`. ثم، أدخل الشيفرة في القائمة 7-1 في _src/lib.rs_ لتعريف بعض الوحدات وتوقيعات الدوال؛ هذه الشيفرة هي قسم front of house.

<Listing number="7-1" file-name="src/lib.rs" caption="وحدة `front_of_house` تحتوي على وحدات أخرى تحتوي بدورها على دوال">

```rust,noplayground
{{#rustdoc_include ../listings/ch07-managing-growing-projects/listing-07-01/src/lib.rs}}
```

</Listing>

نعرف وحدة بالكلمة المفتاحية `mod` متبوعة باسم الوحدة (في هذه الحالة، `front_of_house`). ثم يذهب جسم الوحدة داخل أقواس معقوفة. داخل الوحدات، يمكننا وضع وحدات أخرى، كما في هذه الحالة مع الوحدات `hosting` و`serving`. يمكن أن تحتوي الوحدات أيضاً على تعريفات لعناصر أخرى، مثل البنيات، والعدديات، والثوابت، والخصائص، وكما في القائمة 7-1، الدوال.

باستخدام الوحدات، يمكننا تجميع التعريفات ذات الصلة معاً وتسمية سبب ترابطها. يمكن للمبرمجين الذين يستخدمون هذه الشيفرة التنقل في الشيفرة بناءً على المجموعات بدلاً من الاضطرار إلى القراءة من خلال جميع التعريفات، مما يسهل العثور على التعريفات ذات الصلة بهم. سيعرف المبرمجون الذين يضيفون وظائف جديدة إلى هذه الشيفرة أين يضعون الشيفرة للحفاظ على تنظيم البرنامج.

في وقت سابق، ذكرنا أن _src/main.rs_ و _src/lib.rs_ تُسمى _جذور الصندوق_. سبب تسميتها هو أن محتويات أي من هذين الملفين يشكل وحدة باسم `crate` في جذر بنية وحدة الصندوق، المعروفة باسم _شجرة الوحدات_.

تُظهر القائمة 7-2 شجرة الوحدات للبنية في القائمة 7-1.

<Listing number="7-2" caption="شجرة الوحدات للشيفرة في القائمة 7-1">

```text
crate
 └── front_of_house
     ├── hosting
     │   ├── add_to_waitlist
     │   └── seat_at_table
     └── serving
         ├── take_order
         ├── serve_order
         └── take_payment
```

</Listing>

تُظهر هذه الشجرة كيف تتداخل بعض الوحدات داخل وحدات أخرى؛ على سبيل المثال، `hosting` تتداخل داخل `front_of_house`. تُظهر الشجرة أيضاً أن بعض الوحدات هي _أشقاء_، مما يعني أنها معرفة في نفس الوحدة؛ `hosting` و`serving` هما أشقاء معرفان ضمن `front_of_house`. إذا كانت الوحدة A موجودة داخل الوحدة B، نقول أن الوحدة A هي _ابن_ للوحدة B وأن الوحدة B هي _أصل_ للوحدة A. لاحظ أن شجرة الوحدات بأكملها متجذرة تحت الوحدة الضمنية باسم `crate`.

قد تذكرك شجرة الوحدات بشجرة دليل نظام الملفات على جهاز الكمبيوتر الخاص بك؛ هذه مقارنة مناسبة جداً! تماماً مثل الأدلة في نظام الملفات، تستخدم الوحدات لتنظيم شيفرتك. وتماماً مثل الملفات في دليل، نحتاج إلى طريقة للعثور على وحداتنا.
